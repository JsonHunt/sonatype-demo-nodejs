// Generated by CoffeeScript 2.3.2
(function() {
  // This module is used to provide conversion of numbers into English language form.
  // Conversion is done in translate method. All other methods are 'private'
  var capitalize, peekEnd, peekStart, removeEnd, removeStart, words;

  words = require('./words');

  capitalize = function(str) {
    return str.substr(0, 1).toUpperCase() + str.substr(1);
  };

  peekStart = function(str, howMany) {
    return str.substr(0, howMany);
  };

  removeStart = function(str, howMany) {
    return str.substr(howMany);
  };

  peekEnd = function(str, howMany) {
    return str.substr(-howMany);
  };

  removeEnd = function(str, howMany) {
    return str.substr(0, str.length - howMany);
  };

  module.exports = {
    addSpace: function(str) {
      if ((str.length > 0) && (str[str.length - 1] !== ' ')) {
        return str + ' ';
      } else {
        return str;
      }
    },
    validateInteger: function(str) {
      return /^-?[123456789]\d*$/.test(str) || /^0$/.test(str);
    },
    // getParts method breaks up the number into three-digit parts
    getParts: function(str) {
      var parts;
      parts = [];
      while (str.length > 2) {
        parts.push(peekEnd(str, 3));
        str = removeEnd(str, 3);
      }
      if (str.length > 0) {
        parts.push(str);
      }
      parts.reverse();
      return parts;
    },
    // translatePart method translates individual three-digit parts of a potentially larger number
    // useAnd parameter tells the method whether or not to generate 'and' after hundreds part
    translatePart: function(part, useAnd) {
      var hasAnd, hun, ones, tens, text;
      while (part[0] === '0') {
        part = removeStart(part, 1);
      }
      text = "";
      if (part.length === 3) {
        hun = parseInt(part[0]);
        part = removeStart(part, 1);
      }
      if (part.length === 2) {
        tens = parseInt(part[0]);
        if (tens === 1) {
          tens = parseInt(part);
          part = removeStart(part, 2);
        } else {
          tens *= 10;
          part = removeStart(part, 1);
        }
      }
      if (part.length === 1) {
        ones = parseInt(part[0]);
      }
      hasAnd = useAnd && (tens || ones);
      if (hun) {
        text += words[hun] + ' ' + words[100];
      }
      if (hasAnd) {
        text = this.addSpace(text) + 'and';
      }
      if (tens) {
        text = this.addSpace(text) + words[tens];
      }
      if (ones) {
        text = this.addSpace(text) + words[ones];
      }
      return text.trim();
    },
    // Translate method accepts an integer (positive or negative) as an input and produces English language equivalent.
    // It handles minus sign, concatenation of parts and capitalization of the first letter.
    translate: function(number) {
      var isNegative, isValid, partText, parts, text, useAnd;
      if (number === '0') {
        return capitalize(words['0']);
      }
      text = "";
      if ((number === void 0) || (number.length === 0)) {
        throw new Error("Missing parameter. Integer is required");
      }
      isValid = this.validateInteger(number);
      if (!isValid) {
        throw new Error('Invalid parameter. Only integers are allowed');
      } else {
        if (number.indexOf("-") === 0) {
          isNegative = true;
          number = number.substr(1);
        }
        if (number.length > 30) {
          throw new Error('Invalid parameter. Number must be smaller than 1 nonillion');
        }
        parts = this.getParts(number);
        while (parts.length > 0) {
          useAnd = (number.length > 2) && parts.length === 1;
          partText = this.translatePart(parts[0], useAnd);
          if (partText.length > 0) {
            text = this.addSpace(text) + partText;
          }
          parts.shift();
          if (parts.length > 0 && partText.length > 0) {
            text = this.addSpace(text) + words.bigNumbers[parts.length];
          }
        }
        if (isNegative) {
          text = words['-'] + ' ' + text;
        }
        return capitalize(text.trim());
      }
    }
  };

}).call(this);
